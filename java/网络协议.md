传输层

tcp    游览器端口:12345
       电商应用端口:443
http   post,url,Http1.1 正文格式json,正文长度:12
	   我要买什么，买多少
	   
网络层

		
ip	   客户端电脑Ip:192.168.1.101
	   电务器ip:106.114.138.23
tcp    游览器端口:12345
       电商应用端口:443
http   post,url,Http1.1 正文格式json,正文长度:12
	   我要买什么，买多少
	   
	   
操作系统怎么把消息发送目标地址？
ip地址是本地还是外地
类比去过国外要经过海关，去外地就要去网关.
操作系统启动会被DHCP 协议配置IP地址，以及默认网关地址ip192.168.1.1
操作系统怎么把消息发送目标网关了？
本地通讯靠吼(arp协议)？操作系统问谁是192.168.1.1？网关会回答 我就是本地地址村东头（mac地址）

mac    客户端电脑mac:192.168.1.101的mac
	   网关的mac:192.168.1.1的mac
ip	   客户端电脑Ip:192.168.1.101
	   电务器ip:106.114.138.23
tcp    游览器端口:12345
       电商应用端口:443
http   post,url,Http1.1 正文格式json,正文长度:12
	   我要买什么，买多少

网卡发送数据到网关

网关是路由器,到某个id的地址怎么走,叫路由表
路由器像西游记的西行的一个个国家的城关。每个城关连接2个国家。每个国家相当于一个局域网。每个国家内部，都可以使用本地的mac进行通讯

到了城关，拿出ip头 来之东土大唐(原ip) 去西天（目标ip）请问怎么走？

去ip段1,走网口1，下一跳为路由器A    去女儿国，左边，下一站女儿国东门
去ip段2,走网口2，下一跳为路由器B    去车迟国，中间，下一站车迟国东门
去ip段3,走网口3，下一跳为路由器C    去傲来国，右边，下一站傲来国东门

城关和城关经常沟通，到哪里应该怎么走？这种沟通的协议叫路由协议，常用有ospf和bgp

知道城关，还需要使用国家内部的mac地址
通过当前的城关的mac,找到一下个城关，最后一个城关。对着国家吼，谁是目标ip?
目标ip就会回复一个mac地址。网络包过关后，通过这个mac地址找到目标服务器。


网络为啥分层？
复杂的程序都要分层
想象网络包是一段buffer或者一块内存,是有格式的。同时想象自己是一个处理网络包的程序，这个程序可以跑在电脑上，服务器上，交换机上，路由器上。从某个网络进来，然后再出去。网络很复杂程序也很复杂。复杂的程序都要分层的。复杂的电商会分数据层，缓存层，compose层，controller层和接入层。每一层专注本层的事情。


游览器   buffer给tcp层 		 发送请求  						http头+http正文 
         send_tcp(bffer)	 加上tcp头(端口) 				tcp头+http头+http正文
		 send_layer3(buffer) 加上ip头(目标地址) 			ip头+tcp头+http头+http正文
		 send_layer2(buffer) 加上mact头(目标mac或者网关mac) mac头+ip头+tcp头+http头+http正文
		 
		 buffer mac头+ip头+tcp头+http头+http正文
		 
		 
		 buffer mac头+ip头+tcp头+http头+http正文						网络包流入
		 process_layer2(buffer)											解开mac层看是不是发给自己的，如果是，发给三层
		 process_layer3(buffer)											解开ip层是不是自己的，如果不是转发，如果是自己的 会调procee_tcp/udp 发送给四层
		 process_tcp(buffer)											解开tcp头 看是发起还是应答，正常数据包，然后分不同逻辑。如果是发起应答发送回复包。如果是正常数据就要交给下层
游览器   网络包处理 http头	网页正常返http正文 网页正文 http头+http正文 根据四层头的端口交给应用处理。如果游览器监听这个端口，交给游览器



二层设备 把mac头摘下来，到底是丢弃 转发还是自己留着
三层设备 吧mac，ip头摘下来 到底是丢弃 转发还是自己留着

无类型域间选路（cidr）
32ip地址1分为2，前面是网络号，后面是主机号
		10.100.122.2/24
广播地址10.100.122.255 如果发送这个地址 10.100.122网络可以接受这个消息。另一个是子网掩码255.255.255.0

例子 16.158.165.91/22
16.158.101100101.91  16+6
16.158.<101001>.<01>.91

16 .158.<101001>.<00>.1    16.158.164.1(第一地址)  
255.255.<111111>.<00>.0    255.255.252.0(掩码)
16 .158.<101001>.<11>.255  16.158.167.255(广播地址)


作用目标ip and 淹没等于自己ip
如果主机号都是11111的就是广播
	










